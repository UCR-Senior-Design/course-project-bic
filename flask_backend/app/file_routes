from flask import Blueprint, request, jsonify, redirect
from google.cloud import storage

file_routes = Blueprint('file_routes', __name__)

@file_routes.route('/get_file', methods=['GET'])
def get_file():
    file_name = request.args.get('file_name')
    # Replace 'your-bucket-name' with your actual GCS bucket name
    signed_url = generate_signed_url('your-bucket-name', file_name)
    return redirect(signed_url)

def generate_signed_url(bucket_name, file_name):
    client = storage.Client()
    bucket = client.bucket(bucket_name)
    blob = bucket.blob(file_name)

    # Generate a signed URL with a specific expiration time (e.g., 1 hour)
    signed_url = blob.generate_signed_url(
        expiration=3600,  # Expiration time in seconds
        method='GET'
    )

    return signed_url